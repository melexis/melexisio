<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MelexisIO SCPI Commands: EEPROM SCPI Command Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../melexis-logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">MelexisIO SCPI Commands
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('d2/d5d/md_SCPI_commands_eeprom.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">EEPROM SCPI Command Reference </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >Compact reference for the EEPROM emulation interface. The module stores a JSON document in RAM (<code>eeprom_buffer</code>) and persists versioned snapshots as binary records in a dedicated Flash sector.</p>
<blockquote class="doxtable">
<p >&zwj;On system startup / reset the firmware loads the last valid persisted record (latest intact) into the RAM buffer automatically. </p>
</blockquote>
<hr  />
 <h1><a class="anchor" id="autotoc_md41"></a>
1. Binary Record Layout</h1>
<p >Each persisted record (little endian): </p><div class="fragment"><div class="line">uint32 magic       = 0x1504</div>
<div class="line">uint32 json_len    = N (bytes, excluding terminating NUL)</div>
<div class="line">uint32 crc32       = zlib_crc32(JSON, start=ZLIB_CRC32_START)</div>
<div class="line">uint8  json[N]     // UTF-8 JSON payload</div>
<div class="line">uint8  0x00        // terminating NUL</div>
<div class="line">padding 0..3 bytes (0x00) to 4-byte alignment</div>
</div><!-- fragment --><p> Records are appended sequentially until no space remains or corruption is detected. An erased word reads 0xFFFFFFFF.</p>
<hr  />
 <h1><a class="anchor" id="autotoc_md43"></a>
2. Command Summary</h1>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Command   </th><th class="markdownTableHeadNone">Parameters   </th><th class="markdownTableHeadNone">Action    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>:EeProm:INIT</code>   </td><td class="markdownTableBodyNone">*(none or index)*   </td><td class="markdownTableBodyNone">Load latest record (no param / -1) or 0-based record index.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>:EeProm:ERASE</code>   </td><td class="markdownTableBodyNone">-   </td><td class="markdownTableBodyNone">Clear RAM buffer only (Flash untouched).    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>:EeProm:DUMP</code>   </td><td class="markdownTableBodyNone">-   </td><td class="markdownTableBodyNone">Pretty-print current RAM JSON.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>:EeProm:SAVE</code>   </td><td class="markdownTableBodyNone"><em>optional 0/1</em>   </td><td class="markdownTableBodyNone">Persist RAM JSON (append 0/None or 1 to force erase all).    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>:EeProm:RECords?</code>   </td><td class="markdownTableBodyNone">-   </td><td class="markdownTableBodyNone">List all valid / first corrupt Flash records.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>:EeProm:Object?</code>   </td><td class="markdownTableBodyNone">key[.prop]   </td><td class="markdownTableBodyNone">Pretty-print object at top-level key.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>:EeProm:String</code>   </td><td class="markdownTableBodyNone">key[.prop],value   </td><td class="markdownTableBodyNone">Set string.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>:EeProm:Integer</code>   </td><td class="markdownTableBodyNone">key[.prop],value   </td><td class="markdownTableBodyNone">Set integer.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>:EeProm:Float</code>   </td><td class="markdownTableBodyNone">key[.prop],value   </td><td class="markdownTableBodyNone">Set float.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>:EeProm:Boolean</code>   </td><td class="markdownTableBodyNone">key[.prop],value   </td><td class="markdownTableBodyNone">Set boolean (0/1/true/false/on/off/yes/no).    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>:EeProm:String?</code>   </td><td class="markdownTableBodyNone">key[.prop]   </td><td class="markdownTableBodyNone">Get string.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>:EeProm:Integer?</code>   </td><td class="markdownTableBodyNone">key[.prop]   </td><td class="markdownTableBodyNone">Get integer.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>:EeProm:Float?</code>   </td><td class="markdownTableBodyNone">key[.prop]   </td><td class="markdownTableBodyNone">Get float.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>:EeProm:Boolean?</code>   </td><td class="markdownTableBodyNone">key[.prop]   </td><td class="markdownTableBodyNone">Get boolean.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>:EeProm:DELete</code>   </td><td class="markdownTableBodyNone">key[.prop]   </td><td class="markdownTableBodyNone">Delete key or property.   </td></tr>
</table>
<p >Notes:</p><ul>
<li>Keys are case-sensitive; command mnemonics are case-insensitive.</li>
<li>Nested access uses <code>.</code> (e.g. <code>net.port</code>). Missing objects are auto-created on set.</li>
</ul>
<hr  />
 <h1><a class="anchor" id="autotoc_md45"></a>
3. INIT Behavior</h1>
<p ><code>:EeProm:INIT</code> scans the sector, validating consecutive records:</p><ol type="1">
<li>Stop at first 0xFFFFFFFF (free space) or structural/CRC error.</li>
<li>Latest fully valid record is chosen by default (this same logic is run automatically at startup).</li>
<li><code>:EeProm:INIT,&lt;n&gt;</code> loads record index <em>n</em> (0-based) if valid; aborts if out of range.</li>
<li>If the newest record is corrupt, the last prior valid record is loaded.</li>
</ol>
<p >Return messages (examples): </p><div class="fragment"><div class="line">EEPROM loaded latest record len=400 crc=0x99887766</div>
<div class="line">EEPROM loaded record 2 len=128 crc=0x1A2B3C4D</div>
<div class="line">EEPROM loaded previous valid record len=256 crc=0x55AA9911 (newest corrupted)</div>
<div class="line">EEPROM record 5 not found</div>
<div class="line">EEPROM empty (no records)</div>
<div class="line">EEPROM corrupted -&gt; cleared</div>
</div><!-- fragment --><hr  />
 <h1><a class="anchor" id="autotoc_md47"></a>
4. SAVE Behavior</h1>
<p >Syntax: <code>:EeProm:SAVE</code> or <code>:EeProm:SAVE,«erase»</code> where «erase» is 0 or 1.</p>
<p >Flow:</p><ol type="1">
<li>If RAM buffer is empty (<code>""</code>), it is converted to <code>{}</code> before saving.</li>
<li>If «erase» = 1: erase sector, write record at offset 0 (no duplicate check).</li>
<li>Else: scan for first free slot; validate chain.</li>
<li>If last record matches (same length, CRC, and bytes) → skip (no Flash write).</li>
<li>If insufficient space → erase sector then write at offset 0.</li>
<li>On corruption during scan → erase sector then write at offset 0.</li>
</ol>
<p >Messages: </p><div class="fragment"><div class="line">EEPROM unchanged (skip save) len=400 crc=0x99887766</div>
<div class="line">EEPROM saved: json=420 bytes crc=0xDEADBEEF total=436 bytes @offset=0x0000 (forced erase)</div>
<div class="line">EEPROM saved: json=128 bytes crc=0x12345678 total=140 bytes @offset=0x01B4 (sector erased)</div>
</div><!-- fragment --><p >Empty JSON example: </p><div class="fragment"><div class="line">:EeProm:ERASE</div>
<div class="line">:EeProm:SAVE</div>
<div class="line">--&gt; EEPROM saved: json=2 bytes ...</div>
</div><!-- fragment --><hr  />
 <h1><a class="anchor" id="autotoc_md49"></a>
5. RECords? Output</h1>
<p ><code>:EeProm:RECords?</code> prints table until free space or first corruption: </p><div class="fragment"><div class="line">Idx  Offs  Len   CRC        Status</div>
<div class="line"> 0   0x000  256  0x1234ABCD  OK</div>
<div class="line"> 1   0x110  300  0x89EF0123  OK</div>
<div class="line"> 2   0x23C  ----  --------   CORRUPT (bad magic 0xFFFF0000)</div>
<div class="line">Summary: valid=2 total_scanned=3 (stopped on corruption)</div>
</div><!-- fragment --><p> Status meanings:</p><ul>
<li>OK - Structure + CRC valid.</li>
<li>BADCRC - CRC mismatch (scan stops).</li>
<li>CORRUPT - Structural issue (magic, length, terminator, overflow).</li>
</ul>
<hr  />
 <h1><a class="anchor" id="autotoc_md51"></a>
6. GET / SET Formats</h1>
<p >Outputs:</p><ul>
<li>String: <code>key="value"</code></li>
<li>Integer: <code>key=123</code></li>
<li>Float: <code>key=1.23</code></li>
<li>Boolean: <code>key=0|1</code> On success for set/delete: <code>OK</code>.</li>
</ul>
<p >Error samples: </p><div class="fragment"><div class="line">ERR: get &#39;wifi.ssid&#39; not found</div>
<div class="line">ERR: set &#39;val&#39; buffer too small</div>
<div class="line">ERR: invalid integer</div>
<div class="line">ERR: delete &#39;wifi.mode&#39; not found</div>
</div><!-- fragment --><hr  />
 <h1><a class="anchor" id="autotoc_md53"></a>
7. Deletion</h1>
<p ><code>:EeProm:DELete key</code> removes whole key. <code>:EeProm:DELete parent.child</code> removes only <code>child</code> from object <code>parent</code>. Nonexistent targets report an error.</p>
<hr  />
 <h1><a class="anchor" id="autotoc_md55"></a>
8. Edge Cases &amp; Limits</h1>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Case   </th><th class="markdownTableHeadNone">Handling    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Empty buffer save   </td><td class="markdownTableBodyNone">Auto-converted to <code>{}</code>.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Duplicate save   </td><td class="markdownTableBodyNone">Skipped if identical (wear reduction).    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Full sector   </td><td class="markdownTableBodyNone">Auto-erase (unless skip) then write at offset 0.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Corruption mid-chain   </td><td class="markdownTableBodyNone">Stop scan; latest prior valid used; next save may erase.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Oversized JSON   </td><td class="markdownTableBodyNone">Rejected with error before Flash write.   </td></tr>
</table>
<p >Maximum JSON length per record: <code>EE_SECTOR_SIZE - 12 - 1 - padding</code>.</p>
<hr  />
 <h1><a class="anchor" id="autotoc_md57"></a>
9. Typical Session</h1>
<div class="fragment"><div class="line">:EeProm:INIT</div>
<div class="line">:EeProm:String device.name,NodeA</div>
<div class="line">:EeProm:Integer net.port,502</div>
<div class="line">:EeProm:SAVE</div>
<div class="line">:EeProm:String device.name,NodeA   (unchanged)</div>
<div class="line">:EeProm:SAVE        --&gt; skip</div>
<div class="line">:EeProm:RECords?</div>
<div class="line">:EeProm:INIT,0      (load oldest)</div>
<div class="line">:EeProm:SAVE,1      (force new baseline)</div>
</div><!-- fragment --><hr  />
 <h1><a class="anchor" id="autotoc_md59"></a>
10. Return Codes (Internal)</h1>
<ul>
<li>Success operations return HAL_OK (0) to caller layer.</li>
<li>Flash / validation failures return HAL_ERROR (non-zero) and print an error if verbose.</li>
</ul>
<hr  />
 <h1><a class="anchor" id="autotoc_md61"></a>
11. Verbosity</h1>
<p >Internal helper APIs may suppress printing when <code>verbose == 0</code>. SCPI command layer typically prints always.</p>
<hr  />
<p> End of EEPROM SCPI reference. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5 </li>
  </ul>
</div>
</body>
</html>
